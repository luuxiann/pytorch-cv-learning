## MDocAgent: A Multi-Modal Multi-Agent Framework for Document Understanding
## MDocAgent:一种用于文档理解的多模态多智能体框架
### Introduction  
#### 研究背景
1. Answering questions based on reference documents(DocQA)在信息检索和自动化文档分析等方向有重要应用。
2. LLMs只能处理文本信息，LVLMs则常用于DocQA。LVLMs在处理视觉内容时表现优异，但在处理长文档时表现不佳，缺乏对细节的细致关注，同时在跨模态理解方面也存在局限性。单模态上下文检索可以处理长文档，但仍然面临详细分析或跨模态信息整合的问题。
   ![RAG](./pictures/RAG1.png)
3. 文档中通常存在大量信息。直接处理整个文档会消耗大量计算资源，导致模型难以识别最关键的信息。
4. RAG作为辅助工具被引入来提取长文档中关键字解决以上问题，但其仅在分别处理文本和视觉信息时有效，当同时处理两者时，会有些力不从心。
#### 挑战
DocQA中问题的多样性和涵盖信息的复杂性。
1. LVLMs则常用于DocQA。LVLMs在处理视觉内容时表现优异，但在处理长文档时表现不佳，缺乏对细节的细致关注，同时在跨模态理解方面也存在局限性。
2. 现有RAG缺乏跨模态信息整合能力。这种无法有效整合多模态信息的缺陷，制约了当前基于RAG的方法在复杂文档问答任务中的表现。
   
#### 框架概览
MDocAgent该框架融合了检索-生成（RAG）技术与协作式多智能体系统，通过专业智能体协同处理文本与图像信息。系统采用双线程RAG架构：文本RAG负责基础信息提取，图像RAG专注视觉内容分析。整个框架包含五大智能体：通用智能体负责多模态预处理，关键智能体精准识别核心信息，文本智能体进行文本解析，图像智能体执行模态内深度分析，最终由摘要智能体整合生成完整答案。
运作分为五个阶段：(1) 文档预处理：通过OCR提取文本，并将页面保存为图像。(2) 多模态上下文检索：基于文本和图像的RAG工具分别检索出前k个相关文本片段和图像页面。(3) 初始分析与关键信息提取：通用智能体生成初步响应，关键智能体提取核心信息并传递给专业智能体。(4) 专业智能体处理：文本和图像智能体根据关键信息，分别在其专业领域内分析检索到的上下文。(5) 答案综合：摘要智能体整合所有智能体的响应，生成最终答案。
    ![RAG](./pictures/MDocAgent.jpg)
MDocAgent框架概述：这是一个支持多模态交互的多智能体系统，其运作流程包含五个阶段：(1) 使用PDF工具处理文档以提取文本和图像。(2) 基于文本和图像的RAG检索系统会筛选出前k个相关片段和图像页面。(3) 通用智能体提供初步答案，而关键智能体则从两种模态中提取核心信息。(4) 专业智能体分别处理各自模态中的检索信息和关键信息，生成优化后的答案。(5) 总结智能体整合所有前期输出，最终生成完整答案。
### Related Work
1. **LVLMs in DocQA Tasks** : LVLMs能将图像中的文本转化为视觉表征，同时保留版式和视觉上下文。然而，这类模型仍面临输入规模限制和可能丢失细粒度文本细节等挑战，因此实现文本与视觉信息的有效整合，对DocVQA的精准性能至关重要
2. **Retrieval-Augmented Generation(RAG)** : 现有的针对LVLMs的图像RAG可以用以检索视觉相关，但因为检索的相互独立进行，无法有效整合和分析文本和图像信息。
3. **Multi-Agent Systems** : 多智能体系统可以通过配置专业智能体分工协作，共同完成单一模型难以应对的任务。然而在DocQA应用中，由于需要整合多种模态信息，系统面临独特挑战。单纯叠加文本与图像智能体的输出，往往难以捕捉二者间的微妙交互——这种交互正是准确理解文档的关键。

### MDocAgent(details)
#### 文档预处理
1. 目标：将文档语料库转换为适合文本与视觉分析的格式
2. 技术：采用光学字符识别（OCR）与PDF解析技术相结合的方式提取文本内容。这种双管齐下的方法确保了对不同文档格式和结构的稳健文本提取。
3. 该框架允许通过整合文本与视觉线索实现全面理解。预处理过程生成文档语料库的双重表征：文本表征由提取的文本片段构成，视觉表征则包含原始页面图像。
#### 多模态上下文检索
1. 目标：在同时兼顾文本和图像信息的基础上，从文档语料库中高效检索最相关的信息。

